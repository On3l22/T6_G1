<?php
class ProcesarDatos
{
    public $edad;
    public $genero;
    public $primera_cita;
    public $tipo_servicio;
    public $fecha;

    private $subtotal_examenes;
    private $totalbrt;
    private $descjubilado;

    public function __construct($edad, $genero, $primera_cita, $tipo_servicio, $examenes_seleccionados, $fecha)
    {
        $this->edad = $edad;
        $this->genero = $genero; 
        $this->primera_cita = $primera_cita;
        $this->tipo_servicio = $tipo_servicio;
        $this->fecha = $fecha;

        $this->subtotal_examenes = 0;
        foreach ($examenes_seleccionados as $key => $value) {
            $this->subtotal_examenes += (float) $value;
        }

        $this->totalbrt = $this->CalcularTotalBruto();
        $this->descjubilado = $this->CalcularDescuentoJubilado();
    }

    // Total bruto = exámenes + cita médica
    public function CalcularTotalBruto()
    {
        $total = $this->subtotal_examenes;

        if ($this->tipo_servicio === "Atención de Medicina general") {
            $total += ($this->primera_cita === "Sí") ? 20 : 15;
        } elseif ($this->tipo_servicio === "Atención de Especialista") {
            $total += ($this->primera_cita === "Sí") ? 40 : 30;
        }

        return $total;
    }

    public function CalcularDescuentoJubilado()
    {
        if (($this->genero === "masculino" && $this->edad >= 60) ||
            ($this->genero === "femenino" && $this->edad >= 57)) {
            return $this->totalbrt * 0.10;
        }
        return 0;
    }

    // Octubre solo aplica a exámenes, no al total bruto
    public function CalcularDescuentoOctubre()
    {
        $fecha_obj = new DateTime($this->fecha);
        $mes = $fecha_obj->format('m');

        if ($mes === "10" && $this->subtotal_examenes > 0) {
            return $this->subtotal_examenes * 0.10;
        }

        return 0;
    }

    public function CalcularPrecio($totalbt, $descuento1, $descuento2)
    {
        return $totalbt - ($descuento1 + $descuento2);
    }
}
?>
